---
title: 安全漏洞解决方案
key: 安全漏洞解决方案
tags: [安全漏洞]
---

## XSS跨站漏洞

现象：表单输入框输入`<svg/onload=alert(2)>`,点击保存后进行查看。如果出现弹窗，存在XSS漏洞。

解决方案：

1. 应用添加过滤器。将常见的关键字进行转义`;`,`'`,`"`,`<>`,`()`,`,`,`\`,`script`,`svg`,`alert`,`confirm`,`prompt`,`onload`,`onmouseover`,`onfocus`,`onerror`,`xss`.还要注意大小写的问题。这里直接使用`org.springframework.web.util.HtmlUtils.htmlEscape()`进行转义。

2. 在HTTP Header 头中添加 `X-XSS-Protection`,`Content-Security-Policy`.这部分spring seurity 帮忙做了。

## CSRF跨站请求伪造

现象：非本站发起的请求。外站访问本站的链接，借助于本站存在的cookie发起请求。

解决方案：

1. 验证referer字段 安全性低，改造简单，容易误伤自己
2. token验证 全部改造困难，安全性高
3. HTTP 头中自定义属性并验证 不适用同步请求

最终使用了验证referer字段进行保护。对应用的影响是无法在新标签页打开页面。

## 明文传输

https

## Host主机头攻击

现象：`curl --header "Host: www.baidu.com" http://132.91.153.197:8085/login.sp -v` 返回报文将请求重定向到百度。


解决方案： 

nginx 存在default_server。配置default_server.并且将业务server 的server_name 修改为指定的对外ip。

```conf

server {
    listen       8085;
    server_name  132.91.153.197 132.91.153.11 127.0.0.1;
    ...
}
server {
  listen 8085 default_server;
  server_name _;
  return 403; # 403 forbidden
}

```

## Apache Tomcat示例目录漏洞

删除tomcat webapps 目录下示例程序，只留下业务应用。

## Snoop Servlet信息披露

删除tomcat webapps 目录下示例程序，只留下业务应用

## 不安全的crossdomain.xml文件

目前业务上没有使用到cors访问。直接禁掉

```conf
location /crossdomain.xml {
    return 403;
}

```

## Apache Tomcat示例文件

删除tomcat webapps 目录下示例程序，只留下业务应用

## 启用了不安全的options方法

1. servlet直接对外

```xml
<security-constraint>
    <web-resource-collection>
        <web-resource-name>onlyGetAndPost</web-resource-name>
        <url-pattern>/*</url-pattern>
        <http-method>PUT</http-method>
        <http-method>DELETE</http-method>
        <http-method>HEAD</http-method>
        <http-method>OPTIONS</http-method>
        <http-method>TRACE</http-method>
    </web-resource-collection>
    <auth-constraint/>
</security-constraint>

```

2. nginx对外

```conf
if ($request_method !~* GET|POST) {
    return 403;
}
```

## 中间件程序版本信息泄露

nginx配置：

```conf
server_tokens off;
```